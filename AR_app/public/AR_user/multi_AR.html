<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AR Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.2.0/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.0/aframe/build/aframe-ar.js"></script>
      </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      <!-- 3Dモデルを表示する場所 -->
    </a-scene>

    <script>
      // APIからARデータを取得
      fetch('/api/multiAR')
        .then(response => response.json())
        .then(data => {
          data.forEach(item => {
            // マーカーを作成
            const marker = document.createElement('a-marker');
            marker.setAttribute('type', 'pattern');
            marker.setAttribute('url', item.patt); // マーカーパターンのパス

            // 3Dモデルのエンティティを作成
            const modelEntity = document.createElement('a-entity');
            modelEntity.setAttribute('gltf-model', item.mdlimage); // 3Dモデルのファイルパス
            modelEntity.setAttribute('scale', '1 1 1');
            modelEntity.setAttribute('position', '0 0 0');
            modelEntity.setAttribute('visible', 'false'); // 初期状態では非表示

            // 音声ファイルの設定（オプション）
            if (item.soundfile) {
              const soundEntity = document.createElement('a-sound');
              soundEntity.setAttribute('src', `url(${item.soundfile})`);
              modelEntity.appendChild(soundEntity);
            }

            // 字幕ファイルの設定（オプション）
            if (item.napisyfile) {
              const subtitleEntity = document.createElement('a-text');
              subtitleEntity.setAttribute('value', item.napisyfile); // 字幕ファイルの内容を表示
              subtitleEntity.setAttribute('position', '0 1 0');
              modelEntity.appendChild(subtitleEntity);
            }

            // マーカーにモデルを追加
            marker.appendChild(modelEntity);

            // シーンにマーカーを追加
            document.querySelector('a-scene').appendChild(marker);
          });
        })
        .catch(error => {
          console.error('ARデータの取得に失敗しました:', error);
        });
    </script>
  </body>
</html>
