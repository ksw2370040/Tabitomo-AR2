<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Multi Marker</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe-ar.js"></script> <!-- AR.js のライブラリ -->

</head>
<body>
    <!-- ARシーン -->
    <a-scene embedded arjs>
        <!-- カメラ設定 -->
        <a-camera position="0 0 0" gps-projected-camera></a-camera>

        <!-- ARのための3Dモデルとマーカーを動的に生成 -->
        <script>
            // URLパラメータからlanguagenameを取得する関数
            function getUrlParam(name) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(name);
            }

            // languagenameをURLパラメータから取得
            const languagename = getUrlParam('languagename') || '日本語';  // デフォルトは日本語

            // サーバーからデータを取得して3Dモデルを動的に生成
            fetch(`/multiAR?languagename=${encodeURIComponent(languagename)}`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(model => {
                        // 3Dモデルのファイルを読み込む
                        const modelhtml = `
                            <a-asset-item id="${model.mdlid}" src="../Content/.glb/${model.mdlimage}"></a-asset-item>
                        `;
                        document.querySelector('a-scene').innerHTML += modelhtml;

                        // マーカーの設定
                        const markerhtml = `
                            <a-marker id="${model.mdlid}-marker" type="pattern" preset="custom" url="../Content/.patt/${model.patt}"
                                      raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
                                <a-entity id="${model.mdlid}" scale="1 1 1" animation-mixer="loop: repeat" gltf-model="#${model.mdlid}" class="clickable"
                                          animation="property: rotation; to: 0 360 0; dur: 3600; easing: linear; loop: true" gesture-handler
                                          visible="false"></a-entity>
                            </a-marker>
                        `;
                        document.querySelector('a-scene').innerHTML += markerhtml;

                        // 音声がある場合、再生する
                        if (model.soundfile) {
                            const audioElement = document.createElement('audio');
                            audioElement.src = `../Content/${model.soundfile}`;
                            audioElement.preload = 'auto';
                            audioElement.play();
                        }

                        // 字幕がある場合、表示する
                        if (model.napisyfile) {
                            const subtitleElement = document.createElement('div');
                            subtitleElement.classList.add('subtitle');
                            subtitleElement.innerText = model.napisyfile;
                            document.body.appendChild(subtitleElement);
                        }
                    });
                })
                .catch(error => console.error('データ取得エラー:', error));
        </script>
    </a-scene>
</body>
</html>
