<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AR Demo</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://ar-js-org.github.io/AR.js/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      <!-- 3Dモデルを表示する場所 -->
    </a-scene>

    <script>
      // APIからARデータを取得
      fetch('/api/multiAR')
        .then(response => response.json())
        .then(data => {
          data.forEach(item => {
            // マーカーパターンのパス（相対パス）
            const markerPatternPath = `/Content/.patt/${item.patt}`;

            // 3Dモデルのパス（相対パス）
            const modelPath = `/Content/.glb/${item.mdlimage}`;

            // 音声ファイルのパス（相対パス）
            const soundPath = item.soundfile ? `/Content/sound/${item.soundfile}` : null;

            // 字幕ファイルのパス（相対パス）
            const subtitlePath = item.napisyfile ? `/Content/napisy/${item.napisyfile}` : null;

            // マーカーを作成
            const marker = document.createElement('a-marker');
            marker.setAttribute('type', 'pattern');
            marker.setAttribute('url', markerPatternPath);

            // 3Dモデルのエンティティを作成
            const modelEntity = document.createElement('a-entity');
            modelEntity.setAttribute('gltf-model', modelPath);
            modelEntity.setAttribute('scale', '1 1 1');
            modelEntity.setAttribute('position', '0 0 0');
            modelEntity.setAttribute('visible', 'false'); // 初期状態では非表示

            // 音声ファイルの設定（オプション）
            if (soundPath) {
              const soundEntity = document.createElement('a-sound');
              soundEntity.setAttribute('src', `url(${soundPath})`);
              modelEntity.appendChild(soundEntity);
            }

            // 字幕ファイルの設定（オプション）
            if (subtitlePath) {
              const subtitleEntity = document.createElement('a-text');
              subtitleEntity.setAttribute('value', subtitlePath); // 字幕ファイルの内容を表示
              subtitleEntity.setAttribute('position', '0 1 0');
              modelEntity.appendChild(subtitleEntity);
            }

            // マーカーが認識された時にモデルを表示
            marker.addEventListener('tracked', function () {
              modelEntity.setAttribute('visible', 'true');
            });

            // マーカーにモデルを追加
            marker.appendChild(modelEntity);

            // シーンにマーカーを追加
            document.querySelector('a-scene').appendChild(marker);
          });
        })
        .catch(error => {
          console.error('ARデータの取得に失敗しました:', error);
        });
    </script>
  </body>
</html>
